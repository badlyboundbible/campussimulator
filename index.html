    <script>
        // Game state
        let gameState = {
            currentScenario: 0,
            currentMonth: 0,
            currentYear: 1,
            metrics: {
                financial: 60,
                reputation: 65,
                research: 70,
                staff: 55,
                student: 60,
                local: 50
            },
            metricsHistory: {
                financial: [60],
                reputation: [65],
                research: [70],
                staff: [55],
                student: [60],
                local: [50]
            },
            culturalChoices: {
                community: 0,
                individualistic: 0,
                corporate: 0,
                nurturing: 0
            }
        };

        // Month names (single declaration)
        const months = [
            "September", "October", "November", "December", 
            "January", "February", "March", "April", 
            "May", "June", "July", "August"
        ];

        // PWA variables
        let deferredPrompt;
        let isAppInstalled = false;
        let activeCrisis = null;
        let crisisHistory = {};

        // Save/Load Functions
        function saveGame() {
            try {
                const saveData = {
                    version: "1.0",
                    timestamp: Date.now(),
                    gameState: gameState,
                    activeCrisis: activeCrisis,
                    crisisHistory: crisisHistory
                };
                localStorage.setItem('campusSimulatorSave', JSON.stringify(saveData));
                return true;
            } catch (error) {
                console.error("Failed to save game:", error);
                return false;
            }
        }

        function loadGame() {
            try {
                const saveData = localStorage.getItem('campusSimulatorSave');
                if (!saveData) return false;
                
                const parsedData = JSON.parse(saveData);
                gameState = parsedData.gameState || gameState;
                activeCrisis = parsedData.activeCrisis || null;
                crisisHistory = parsedData.crisisHistory || {};
                
                return true;
            } catch (error) {
                console.error("Failed to load game:", error);
                return false;
            }
        }

        // Save/Load Functions (simplified for demo)
        function saveGame() {
            try {
                const saveData = {
                    version: "1.0",
                    timestamp: Date.now(),
                    gameState: gameState,
                    activeCrisis: activeCrisis,
                    crisisHistory: crisisHistory
                };
                localStorage.setItem('campusSimulatorSave', JSON.stringify(saveData));
                return true;
            } catch (error) {
                console.log("Save not available in demo environment");
                return false;
            }
        }

        function loadGame() {
            try {
                const saveData = localStorage.getItem('campusSimulatorSave');
                if (!saveData) return false;
                
                const parsedData = JSON.parse(saveData);
                gameState = parsedData.gameState || gameState;
                activeCrisis = parsedData.activeCrisis || null;
                crisisHistory = parsedData.crisisHistory || {};
                
                return true;
            } catch (error) {
                console.log("Load not available in demo environment");
                return false;
            }
        }

        function autoSave() {
            saveGame();
        }

        function showContinuePrompt() {
            const continueHTML = `
                <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
                <div style="background-color: #0a0a0a; border: 1px solid #00ff00; padding: 20px; margin: 20px 0; border-radius: 5px; text-align: center;">
                    <div style="color: #00ffff; font-size: 18px; margin-bottom: 15px;">Welcome Back!</div>
                    <div style="color: #cccccc; margin-bottom: 20px;">
                        You have a game in progress:<br>
                        <strong style="color: #ffff00;">Year ${gameState.currentYear}, ${months[gameState.currentMonth]}</strong><br>
                        Scenario ${gameState.currentScenario + 1} of 30
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="continue-button" onclick="resumeGame()" style="background-color: #003300;">
                            üì± Continue Game
                        </button>
                        <button class="continue-button" onclick="startNewGame()" style="background-color: #330000;">
                            üÜï Start Over
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('intro-screen').innerHTML = continueHTML;
        }

        function resumeGame() {
            startGame();
        }

        function startNewGame() {
            // Reset game state
            gameState = {
                currentScenario: 0,
                currentMonth: 0,
                currentYear: 1,
                metrics: { financial: 60, reputation: 65, research: 70, staff: 55, student: 60, local: 50 },
                metricsHistory: { financial: [60], reputation: [65], research: [70], staff: [55], student: [60], local: [50] },
                culturalChoices: { community: 0, individualistic: 0, corporate: 0, nurturing: 0 }
            };
            activeCrisis = null;
            crisisHistory = {};
            showIntroScreen();
        }

        function showIntroScreen() {
            const introHTML = `
                <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
                <div style="background-color: #0a0a0a; border: 1px solid #00ff00; padding: 20px; margin: 20px 0; border-radius: 5px;">
                    <div style="color: #00ffff; font-size: 18px; margin-bottom: 15px; font-weight: bold;">
                        Welcome, Campus Manager!
                    </div>
                    <div style="color: #cccccc; line-height: 1.8; margin-bottom: 20px;">
                        You've been appointed to manage a university through <strong style="color: #ffff00;">four years of crisis and transformation</strong>. 
                        Your decisions will shape the institution's future and determine what kind of educational community you create.
                    </div>
                    <div style="color: #00ffff; font-size: 16px; margin: 20px 0 10px 0; font-weight: bold;">
                        üéØ Your Mission:
                    </div>
                    <div style="color: #cccccc; margin-bottom: 20px;">
                        Balance <strong style="color: #00ff00;">six key metrics</strong> while navigating crises, scandals, and recovery. 
                        Each decision reflects a different economic philosophy - choose wisely!
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 20px 0; font-size: 12px;">
                        <div style="color: #00ff00;">üí∞ Financial</div>
                        <div style="color: #00ff00;">‚≠ê Reputation</div>
                        <div style="color: #00ff00;">üî¨ Research</div>
                        <div style="color: #00ff00;">üë• Staff Morale</div>
                        <div style="color: #00ff00;">üéì Students</div>
                        <div style="color: #00ff00;">üèòÔ∏è Local Impact</div>
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="continue-button" onclick="startGame()" style="font-size: 18px; padding: 15px 30px;">
                            üöÄ Begin Your Journey
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('intro-screen').innerHTML = introHTML;
        }

        // Initialize on load - simplified
        window.addEventListener('load', () => {
            showIntroScreen();
        });

        function showContinuePrompt() {
            const continueHTML = `
                <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
                <div style="background-color: #0a0a0a; border: 1px solid #00ff00; padding: 20px; margin: 20px 0; border-radius: 5px; text-align: center;">
                    <div style="color: #00ffff; font-size: 18px; margin-bottom: 15px;">Welcome Back!</div>
                    <div style="color: #cccccc; margin-bottom: 20px;">
                        You have a game in progress:<br>
                        <strong style="color: #ffff00;">Year ${gameState.currentYear}, ${months[gameState.currentMonth]}</strong><br>
                        Scenario ${gameState.currentScenario + 1} of 30
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="continue-button" onclick="resumeGame()" style="background-color: #003300;">
                            üì± Continue Game
                        </button>
                        <button class="continue-button" onclick="startNewGame()" style="background-color: #330000;">
                            üÜï Start Over
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('intro-screen').innerHTML = continueHTML;
        }

        function resumeGame() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            
            const gameContent = createGameScreenHTML();
            document.getElementById('game-screen').innerHTML = gameContent;
            
            // Initialize displays
            updateAllMetrics();
            Object.keys(gameState.metrics).forEach(metric => {
                updateTrendLine(metric);
            });
            
            // Check if we're in a crisis or normal scenario
            const crisisType = findActiveCrisis();
            if (crisisType && shouldRepeatCrisis(crisisType)) {
                showCrisisScenario(crisisType);
            } else {
                displayScenario();
            }
        }

        function startNewGame() {
            // Clear save data
            localStorage.removeItem('campusSimulatorSave');
            
            // Reset game state
            gameState = {
                currentScenario: 0,
                currentMonth: 0,
                currentYear: 1,
                metrics: {
                    financial: 60,
                    reputation: 65,
                    research: 70,
                    staff: 55,
                    student: 60,
                    local: 50
                },
                metricsHistory: {
                    financial: [60],
                    reputation: [65],
                    research: [70],
                    staff: [55],
                    student: [60],
                    local: [50]
                },
                culturalChoices: {
                    community: 0,
                    individualistic: 0,
                    corporate: 0,
                    nurturing: 0
                }
            };
            
            activeCrisis = null;
            crisisHistory = {};
            
            showIntroScreen();
        }

        function showIntroScreen() {
            const introHTML = `
                <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
                
                <div style="background-color: #0a0a0a; border: 1px solid #00ff00; padding: 20px; margin: 20px 0; border-radius: 5px;">
                    <div style="color: #00ffff; font-size: 18px; margin-bottom: 15px; font-weight: bold;">
                        Welcome, Campus Manager!
                    </div>
                    
                    <div style="color: #cccccc; line-height: 1.8; margin-bottom: 20px;">
                        You've just been appointed to manage a university through <strong style="color: #ffff00;">four years of crisis and transformation</strong>. 
                        Your decisions will shape the institution's future and determine what kind of educational community you create.
                    </div>
                    
                    <div style="color: #00ffff; font-size: 16px; margin: 20px 0 10px 0; font-weight: bold;">
                        üéØ Your Mission:
                    </div>
                    
                    <div style="color: #cccccc; margin-bottom: 20px;">
                        Balance <strong style="color: #00ff00;">six key metrics</strong> while navigating crises, scandals, and recovery. 
                        Each decision reflects a different economic philosophy - choose wisely, as your choices compound over time!
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 20px 0; font-size: 12px;">
                        <div style="color: #00ff00;">üí∞ Financial</div>
                        <div style="color: #00ff00;">‚≠ê Reputation</div>
                        <div style="color: #00ff00;">üî¨ Research</div>
                        <div style="color: #00ff00;">üë• Staff Morale</div>
                        <div style="color: #00ff00;">üéì Students</div>
                        <div style="color: #00ff00;">üèòÔ∏è Local Impact</div>
                    </div>
                    
                    <div style="color: #00ffff; font-size: 16px; margin: 20px 0 10px 0; font-weight: bold;">
                        üìä Dashboard Guide:
                    </div>
                    
                    <div style="color: #cccccc; margin-bottom: 15px; font-size: 13px;">
                        <strong style="color: #00ff00;">Green (70-100):</strong> Thriving<br>
                        <strong style="color: #ffff00;">Yellow (40-69):</strong> Warning<br>
                        <strong style="color: #ff6666;">Red (0-39):</strong> Crisis!
                    </div>
                    
                    <div style="color: #cccccc; margin-bottom: 20px; font-size: 13px;">
                        <strong style="color: #00ffff;">Trend Lines:</strong>
                        <strong style="color: #00ff00;">Green</strong> = Improving, 
                        <strong style="color: #ffff00;">Yellow</strong> = Stable, 
                        <strong style="color: #ff6666;">Red</strong> = Declining
                    </div>
                    
                    <div style="background-color: #1a1a00; border: 1px solid #ffff00; padding: 15px; margin: 20px 0; border-radius: 5px;">
                        <div style="color: #ffff00; font-weight: bold; margin-bottom: 10px;">üíæ Auto-Save Enabled</div>
                        <div style="color: #cccccc; font-size: 13px;">
                            Your progress saves automatically. Perfect for daily check-ins!
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="continue-button" onclick="startGame()" style="font-size: 18px; padding: 15px 30px;">
                            üöÄ Begin Your Journey
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('intro-screen').innerHTML = introHTML;
        }

        function createGameScreenHTML() {
            return `
                <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
                
                <div class="game-info">
                    <div>Month: <span id="current-month">${months[gameState.currentMonth]}</span> | Year: <span id="current-year">${gameState.currentYear}</span></div>
                    <div>Scenario: <span id="scenario-count">${gameState.currentScenario + 1}</span> of 30</div>
                </div>
                
                <div class="metrics-display">
                    <div class="metric">
                        <span class="metric-name">Financial:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="financial-trend" viewBox="0 0 50 16" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="financial-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="financial-value">${gameState.metrics.financial}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Reputation:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="reputation-trend" viewBox="0 0 50 16" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="reputation-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="reputation-value">${gameState.metrics.reputation}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Research:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="research-trend" viewBox="0 0 50 16" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="research-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="research-value">${gameState.metrics.research}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Staff:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="staff-trend" viewBox="0 0 50 16" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="staff-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="staff-value">${gameState.metrics.staff}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Students:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="student-trend" viewBox="0 0 50 16" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="student-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="student-value">${gameState.metrics.student}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Local:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="local-trend" viewBox="0 0 50 16" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="local-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="local-value">${gameState.metrics.local}</span>
                        </div>
                    </div>
                </div>
                
                <div class="scenario" id="scenario-container">
                    <!-- Scenario content will be inserted here -->
                </div>
                
                <div id="results-container" style="display: none;">
                    <!-- Results will be shown here -->
                </div>
            `;
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Simulator</title>
    <meta name="description" content="Manage a university through crisis and transformation. Learn economics through gameplay.">
    <meta name="theme-color" content="#00ff00">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNhbXB1cyBTaW11bGF0b3IiLAogICJzaG9ydF9uYW1lIjogIkNhbXB1cyBTaW0iLAogICJkZXNjcmlwdGlvbiI6ICJNYW5hZ2UgYSB1bml2ZXJzaXR5IHRocm91Z2ggY3Jpc2lzIGFuZCB0cmFuc2Zvcm1hdGlvbi4gTGVhcm4gZWNvbm9taWNzIHRocm91Z2ggZ2FtZXBsYXkuIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMxYTFhMWEiLAogICJ0aGVtZV9jb2xvciI6ICIjMDBmZjAwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpRaUlHaGxhV2RvZEQwaU1qUWlJR1pwYkd3OUlpTXdNR1ptTURBaUlIWnBaWGRDYjNnOUlqQWdNQ0F5TkNBeU5DSStQSFJsZUhRZ2VEMGlNaUlnZVQwaU1UWWlJR1pwYkd3OUlpTXdNR1ptTURBaVBqazJNem9tSTJJc092c25KeTQyT21wdE1qODhMMlJsWm5NK1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjI0eDI0IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTkRnaUlHaGxhV2RvZEQwaU5EZ2lJR1pwYkd3OUlpTXdNR1ptTURBaUlIWnBaWGRDYjNnOUlqQWdNQ0EwT0NBME9DSStQSFJsZUhRZ2VEMGlOQ0lnZVQwaU16SWlJR1pwYkd3OUlpTXdNR1ptTURBaVBqazJNem9tSTJJc085c25KeTQyT21wdE1qODhMMlJsWm5NK1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjQ4eDQ4IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRrd0lpQm9aV2xuYUhROU9qRXdNQ0lnWm1sc2JEMGlJekF3Wm1Zd01DSWdkbWxsZDBKdmVEMGlNQ0F3SURFNU1DQXhPVEFpUGp4MFpYaDBJSGc5SWpFd0lpQjVQU0k1TmtJblBqazJPRHNtUXpKRE9UTWdKek16T1RvbUkzSnNOMG9tUjJGNE1UQTRQQzluWW1Zc1BDOTBaWGgwUGp3dmMzWm5QZz09IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1rSWdabWxzYkQwaUl6QXdabVl3TUNJZ2RtbGxkMEp2ZUQwaU1DQXdJRFV4TWlBMU1USmNQang0WkdwMElIZzlJakkxTmlJZ2VUMGlNalUySWlCbWFXeHNQU0lqTURCbVpqQXdJajQ0TnprNmJIaGlKRzQySXlKaE5EWjBZVzF3TzJOMGJHdGphejEzWVdGVFZWcERPRzQzQm5SMmJXaGFjV2sxTlNLUmJXVmhST3AvUEM5MFpYaDBQand2YzNabmNUMGkiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgZmlsbD0iIzAwZmYwMCIgdmlld0JveD0iMCAwIDE5MiAxOTIiPjx0ZXh0IHg9IjEwIiB5PSI5NiI+9638O2M2RzM5OzsKIC0gNVdJQjU1Q3RCc0plT244UzwvdGV4dD48L3N2Zz4=">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 10px;
            line-height: 1.6;
            min-height: 100vh;
            /* Mobile optimizations */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: #0d1b0d;
            border: 2px solid #00ff00;
            padding: 15px;
            border-radius: 10px;
            /* Mobile responsiveness */
            box-sizing: border-box;
        }
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            body {
                padding: 5px;
                font-size: 14px;
            }
            
            .container {
                padding: 10px;
                border-radius: 5px;
            }
            
            .title {
                font-size: 18px !important;
                margin-bottom: 15px !important;
            }
            
            .metrics-display {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
                font-size: 13px;
            }
            
            .choice-button {
                padding: 12px !important;
                font-size: 13px !important;
                margin-bottom: 8px !important;
            }
            
            .scenario-description {
                font-size: 13px !important;
                line-height: 1.5 !important;
            }
            
            .continue-button {
                padding: 12px 20px !important;
                font-size: 14px !important;
            }
        }
        
        @media (min-width: 769px) {
            .container {
                max-width: 800px;
            }
            
            .metrics-display {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .metrics-display {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }
        
        .metrics-display {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #0a0a0a;
            border: 1px solid #00ff00;
            border-radius: 5px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .metric-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trend-line {
            width: 50px;
            height: 16px;
            background-color: #000;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .trend-path {
            stroke-width: 2;
            fill: none;
        }
        
        .trend-path.green {
            stroke: #00ff00;
        }
        
        .trend-path.yellow {
            stroke: #ffff00;
        }
        
        .trend-path.red {
            stroke: #ff6666;
        }
        
        .metric-name {
            font-weight: bold;
            font-size: 12px;
        }
        
        .metric-value {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 14px;
            min-width: 30px;
            text-align: center;
        }
        
        .green { background-color: #004400; color: #00ff00; }
        .yellow { background-color: #444400; color: #ffff00; }
        .red { background-color: #440000; color: #ff0000; }
        
        .scenario {
            background-color: #0a0a0a;
            border: 1px solid #00ff00;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .scenario-title {
            color: #ffff00;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .scenario-description {
            margin-bottom: 20px;
            color: #cccccc;
            line-height: 1.6;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .choice-button {
            background-color: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 14px;
            /* Mobile touch optimization */
            min-height: 44px;
            touch-action: manipulation;
        }
        
        .choice-button:hover, .choice-button:focus {
            background-color: #004400;
            box-shadow: 0 0 10px #00ff00;
            outline: none;
        }
        
        .choice-button:active {
            background-color: #005500;
            transform: translateY(1px);
        }
        
        .choice-label {
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 5px;
        }
        
        .game-info {
            text-align: center;
            margin-bottom: 20px;
            color: #888888;
            font-size: 14px;
        }
        
        .results {
            background-color: #001a1a;
            border: 1px solid #00ffff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .results-title {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-change {
            margin: 5px 0;
            font-size: 13px;
        }
        
        .positive { color: #00ff00; }
        .negative { color: #ff6666; }
        .neutral { color: #cccccc; }
        
        .continue-button {
            background-color: #003366;
            color: #00ffff;
            border: 1px solid #00ffff;
            padding: 15px 30px;
            cursor: pointer;
            border-radius: 5px;
            font-family: inherit;
            font-size: 16px;
            display: block;
            margin: 20px auto;
            /* Mobile touch optimization */
            min-height: 44px;
            touch-action: manipulation;
        }
        
        .continue-button:hover, .continue-button:focus {
            background-color: #004488;
            box-shadow: 0 0 10px #00ffff;
            outline: none;
        }
        
        .continue-button:active {
            background-color: #0055aa;
            transform: translateY(1px);
        }
        
        .triggers {
            background-color: #1a0000;
            border: 1px solid #ff6666;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .triggers-title {
            color: #ff6666;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* Install prompt styles */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background-color: #0d1b0d;
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 15px;
            color: #00ff00;
            text-align: center;
            z-index: 1000;
            display: none;
        }
        
        .install-button {
            background-color: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            margin: 10px 5px 0 5px;
        }
        
        .install-button:hover {
            background-color: #004400;
        }
    </style>
</head>
<body>
        <div id="install-prompt" class="install-prompt">
            <div>üì± Install Campus Simulator on your device for daily check-ins!</div>
            <button class="install-button" onclick="installApp()">Install App</button>
            <button class="install-button" onclick="dismissInstallPrompt()">Maybe Later</button>
        </div>
        
        <div id="intro-screen" class="container">
            <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
            
            <div style="background-color: #0a0a0a; border: 1px solid #00ff00; padding: 20px; margin: 20px 0; border-radius: 5px;">
                <div style="color: #00ffff; font-size: 18px; margin-bottom: 15px; font-weight: bold;">
                    Welcome, Campus Manager!
                </div>
                
                <div style="color: #cccccc; line-height: 1.8; margin-bottom: 20px;">
                    You've just been appointed to manage a university through <strong style="color: #ffff00;">four years of crisis and transformation</strong>. 
                    Your decisions will shape the institution's future and determine what kind of educational community you create.
                </div>
                
                <div style="color: #00ffff; font-size: 16px; margin: 20px 0 10px 0; font-weight: bold;">
                    üéØ Your Mission:
                </div>
                
                <div style="color: #cccccc; margin-bottom: 20px;">
                    Balance <strong style="color: #00ff00;">six key metrics</strong> while navigating crises, scandals, and recovery. 
                    Each decision reflects a different economic philosophy - choose wisely, as your choices compound over time!
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0;">
                    <div style="color: #00ff00;">üí∞ Financial Strength</div>
                    <div style="color: #00ff00;">‚≠ê Reputation</div>
                    <div style="color: #00ff00;">üî¨ Research Quality</div>
                    <div style="color: #00ff00;">üë• Staff Morale</div>
                    <div style="color: #00ff00;">üéì Student Satisfaction</div>
                    <div style="color: #00ff00;">üèòÔ∏è Local Impact</div>
                </div>
                
                <div style="color: #00ffff; font-size: 16px; margin: 20px 0 10px 0; font-weight: bold;">
                    üìä Understanding Your Dashboard:
                </div>
                
                <div style="color: #cccccc; margin-bottom: 15px;">
                    <strong style="color: #00ff00;">Green Zone (70-100):</strong> Thriving - keep up the good work!<br>
                    <strong style="color: #ffff00;">Yellow Zone (40-69):</strong> Warning - attention needed<br>
                    <strong style="color: #ff6666;">Red Zone (0-39):</strong> Crisis - urgent action required!
                </div>
                
                <div style="color: #cccccc; margin-bottom: 20px;">
                    <strong style="color: #00ffff;">Trend Lines:</strong> Watch the mini-charts next to each metric!
                    <br>‚Ä¢ <strong style="color: #00ff00;">Green lines</strong> = Improving trends
                    <br>‚Ä¢ <strong style="color: #ffff00;">Yellow lines</strong> = Stable trends  
                    <br>‚Ä¢ <strong style="color: #ff6666;">Red lines</strong> = Declining trends
                </div>
                
                <div style="color: #00ffff; font-size: 16px; margin: 20px 0 10px 0; font-weight: bold;">
                    üß≠ Four Management Philosophies:
                </div>
                
                <div style="color: #cccccc; margin-bottom: 20px;">
                    <strong style="color: #00ffff;">Community:</strong> Democratic decision-making, shared ownership<br>
                    <strong style="color: #ff9999;">Individualistic:</strong> Competition, merit-based rewards, market solutions<br>
                    <strong style="color: #9999ff;">Corporate:</strong> Professional efficiency, systematic management<br>
                    <strong style="color: #99ff99;">Nurturing:</strong> Human flourishing, comprehensive care
                </div>
                
                <div style="background-color: #1a1a00; border: 1px solid #ffff00; padding: 15px; margin: 20px 0; border-radius: 5px;">
                    <div style="color: #ffff00; font-weight: bold; margin-bottom: 10px;">‚ö†Ô∏è Remember:</div>
                    <div style="color: #cccccc;">
                        ‚Ä¢ Every choice has consequences - watch for cascade effects!<br>
                        ‚Ä¢ Metrics in red zones trigger crisis events<br>
                        ‚Ä¢ Your cultural choices shape what victory looks like<br>
                        ‚Ä¢ There's no single "right" answer - explore different approaches!
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="continue-button" onclick="startGame()" style="font-size: 18px; padding: 20px 40px;">
                        üöÄ Begin Your Journey
                    </button>
                </div>
            </div>
        </div>
        
        <div class="container" id="game-screen" style="display: none;">
        <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
        
        <div class="game-info">
            <div>Month: <span id="current-month">September</span> | Year: <span id="current-year">1</span></div>
            <div>Scenario: <span id="scenario-count">1</span> of 30</div>
        </div>
        
        <div class="metrics-display">
            <div class="metric">
                <span class="metric-name">Financial:</span>
                <div class="metric-info">
                    <svg class="trend-line" id="financial-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                        <polyline class="trend-path yellow" id="financial-path" points=""></polyline>
                    </svg>
                    <span class="metric-value" id="financial-value">60</span>
                </div>
            </div>
            <div class="metric">
                <span class="metric-name">Reputation:</span>
                <div class="metric-info">
                    <svg class="trend-line" id="reputation-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                        <polyline class="trend-path yellow" id="reputation-path" points=""></polyline>
                    </svg>
                    <span class="metric-value" id="reputation-value">65</span>
                </div>
            </div>
            <div class="metric">
                <span class="metric-name">Research:</span>
                <div class="metric-info">
                    <svg class="trend-line" id="research-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                        <polyline class="trend-path yellow" id="research-path" points=""></polyline>
                    </svg>
                    <span class="metric-value" id="research-value">70</span>
                </div>
            </div>
            <div class="metric">
                <span class="metric-name">Staff Morale:</span>
                <div class="metric-info">
                    <svg class="trend-line" id="staff-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                        <polyline class="trend-path yellow" id="staff-path" points=""></polyline>
                    </svg>
                    <span class="metric-value" id="staff-value">55</span>
                </div>
            </div>
            <div class="metric">
                <span class="metric-name">Students:</span>
                <div class="metric-info">
                    <svg class="trend-line" id="student-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                        <polyline class="trend-path yellow" id="student-path" points=""></polyline>
                    </svg>
                    <span class="metric-value" id="student-value">60</span>
                </div>
            </div>
            <div class="metric">
                <span class="metric-name">Local Impact:</span>
                <div class="metric-info">
                    <svg class="trend-line" id="local-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                        <polyline class="trend-path yellow" id="local-path" points=""></polyline>
                    </svg>
                    <span class="metric-value" id="local-value">50</span>
                </div>
            </div>
        </div>
        
        <div class="scenario" id="scenario-container">
            <!-- Scenario content will be inserted here -->
        </div>
        
        <div id="results-container" style="display: none;">
            <!-- Results will be shown here -->
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            currentScenario: 0,
            currentMonth: 0,
            currentYear: 1,
            metrics: {
                financial: 60,
                reputation: 65,
                research: 70,
                staff: 55,
                student: 60,
                local: 50
            },
            research: {
                title: "RESEARCH COLLAPSE",
                description: "The university's research quality has plummeted. Grant applications are being rejected, top researchers are leaving, and the institution risks losing its research status entirely. Academic credibility is in freefall.",
                choices: [
                    {
                        label: "Community Crisis Response",
                        description: "Democratic research revival through collaborative projects",
                        effects: { financial: -10, reputation: 10, research: 25, staff: 15, student: 5, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Crisis Response",
                        description: "Recruit star researchers with massive funding packages",
                        effects: { financial: -25, reputation: 15, research: 35, staff: -10, student: 5, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Crisis Response",
                        description: "Strategic research focus and systematic quality improvement",
                        effects: { financial: -15, reputation: 20, research: 30, staff: 5, student: 0, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Crisis Response",
                        description: "Support existing researchers and create collaborative environment",
                        effects: { financial: -20, reputation: 15, research: 25, staff: 20, student: 10, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            local: {
                title: "COMMUNITY BACKLASH",
                description: "The local community has turned against the university. Town-gown relations are at breaking point, local politicians are hostile, and community support has evaporated. The university is seen as disconnected and arrogant.",
                choices: [
                    {
                        label: "Community Crisis Response",
                        description: "Full community engagement and democratic dialogue with local leaders",
                        effects: { financial: 10, reputation: 20, research: 0, staff: 10, student: 10, local: 30 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Crisis Response",
                        description: "Focus on university excellence, ignore local criticism",
                        effects: { financial: 5, reputation: -5, research: 10, staff: 0, student: -5, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Crisis Response",
                        description: "Professional community relations and strategic partnerships",
                        effects: { financial: 15, reputation: 15, research: 5, staff: 5, student: 5, local: 25 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Crisis Response",
                        description: "Comprehensive community service and local needs focus",
                        effects: { financial: 5, reputation: 25, research: 10, staff: 15, student: 20, local: 35 },
                        culture: "nurturing"
                    }
                ]
            },
            metricsHistory: {
                financial: [60],
                reputation: [65],
                research: [70],
                staff: [55],
                student: [60],
                local: [50]
            },
            culturalChoices: {
                community: 0,
                individualistic: 0,
                corporate: 0,
                nurturing: 0
            }
        };

        // Crisis scenarios that trigger when metrics hit red zone
        const crisisScenarios = {
            financial: {
                title: "FINANCIAL EMERGENCY",
                description: "The university faces immediate insolvency. Creditors are demanding payment, staff haven't been paid, and operations may cease within weeks. Emergency action required!",
                choices: [
                    {
                        label: "Community Crisis Response",
                        description: "Emergency campus-wide meeting to find collective solutions",
                        effects: { financial: 15, reputation: 10, research: -10, staff: 10, student: 5, local: 15 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Crisis Response", 
                        description: "Immediate closure of failing departments, protect profitable areas",
                        effects: { financial: 25, reputation: -5, research: 5, staff: -20, student: -15, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Crisis Response",
                        description: "Professional emergency restructuring and asset liquidation",
                        effects: { financial: 30, reputation: 5, research: -5, staff: -15, student: -10, local: -5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Crisis Response",
                        description: "Seek emergency community support and government intervention",
                        effects: { financial: 20, reputation: 15, research: 0, staff: 15, student: 10, local: 20 },
                        culture: "nurturing"
                    }
                ]
            },
            staff: {
                title: "STAFF REVOLT",
                description: "University staff have called an indefinite strike. Picket lines surround campus, teaching has stopped, and media coverage is damaging. Students are demanding fee refunds.",
                choices: [
                    {
                        label: "Community Crisis Response",
                        description: "Negotiate openly with union representatives for fair resolution",
                        effects: { financial: -10, reputation: 15, research: -5, staff: 25, student: 10, local: 20 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Crisis Response",
                        description: "Break the strike by hiring replacement staff and tough negotiations",
                        effects: { financial: -15, reputation: -10, research: -10, staff: -15, student: -20, local: -15 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Crisis Response",
                        description: "Professional mediation and systematic compromise package",
                        effects: { financial: -5, reputation: 5, research: 0, staff: 15, student: 5, local: 10 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Crisis Response",
                        description: "Address underlying wellbeing issues comprehensively",
                        effects: { financial: -20, reputation: 20, research: 5, staff: 30, student: 15, local: 25 },
                        culture: "nurturing"
                    }
                ]
            },
            student: {
                title: "STUDENT UPRISING",
                description: "Students have occupied the main building demanding immediate changes. Social media campaigns are going viral, parents are withdrawing children, and enrollment for next year is collapsing.",
                choices: [
                    {
                        label: "Community Crisis Response",
                        description: "Join students in democratic reform discussions",
                        effects: { financial: -5, reputation: 10, research: -5, staff: 15, student: 25, local: 15 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Crisis Response",
                        description: "Clear the occupation and focus on high-achieving students only",
                        effects: { financial: 5, reputation: -15, research: 5, staff: -10, student: -20, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Crisis Response",
                        description: "Professional crisis management and structured student engagement",
                        effects: { financial: 0, reputation: 0, research: 0, staff: 5, student: 15, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Crisis Response",
                        description: "Comprehensive response to student needs and concerns",
                        effects: { financial: -15, reputation: 15, research: 0, staff: 10, student: 30, local: 20 },
                        culture: "nurturing"
                    }
                ]
            },
            reputation: {
                title: "REPUTATION COLLAPSE",
                description: "National media coverage has destroyed the university's reputation. Enrollment is plummeting, staff are leaving, and funding bodies are reconsidering support. The institution's survival is threatened.",
                choices: [
                    {
                        label: "Community Crisis Response",
                        description: "Transparent community response showing authentic change",
                        effects: { financial: -10, reputation: 20, research: 0, staff: 15, student: 10, local: 25 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Crisis Response",
                        description: "Aggressive PR campaign highlighting individual successes",
                        effects: { financial: -5, reputation: 15, research: 10, staff: -5, student: 0, local: -5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Crisis Response",
                        description: "Professional reputation management and systematic reform",
                        effects: { financial: 5, reputation: 25, research: 0, staff: 5, student: 5, local: 10 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Crisis Response",
                        description: "Focus on serving community needs regardless of external opinion",
                        effects: { financial: -5, reputation: 15, research: 10, staff: 20, student: 20, local: 30 },
                        culture: "nurturing"
                    }
                ]
            }
        };
        const months = [
            "September", "October", "November", "December", 
            "January", "February", "March", "April", 
            "May", "June", "July", "August"
        ];

        // Complete 48 scenarios for the full game
        const scenarios = [
            // YEAR 1: PANDEMIC YEAR
            {
                title: "Enrollment Surge Crisis",
                description: "Expected 3,000 students but 3,500 enrolled. Accommodation full, lecture halls overcrowded, staff stretched thin. Extra fees could help budget but quality suffers.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Democratic meetings with all stakeholders for collaborative solutions",
                        effects: { financial: -5, reputation: 5, research: -10, staff: 15, student: 10, local: 5 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response", 
                        description: "Accept all paying students - survival of the fittest",
                        effects: { financial: 15, reputation: 5, research: -5, staff: -5, student: -10, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Efficient systems and temporary solutions",
                        effects: { financial: 10, reputation: 5, research: 0, staff: -5, student: -5, local: 0 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Cap numbers to maintain quality and support",
                        effects: { financial: 0, reputation: 10, research: 5, staff: 10, student: 15, local: 5 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Teaching Resource Crisis",
                description: "Lecture halls packed, seminar groups doubled, senior staff complaining, junior lecturers burning out covering gaps.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Staff-student committees to redistribute workload fairly",
                        effects: { financial: -10, reputation: 0, research: -10, staff: 15, student: 5, local: 5 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Hire star lecturers with premium contracts",
                        effects: { financial: -20, reputation: 5, research: 5, staff: -10, student: 10, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Increase class sizes, implement efficiency measures",
                        effects: { financial: 10, reputation: -5, research: 0, staff: -10, student: -15, local: -5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Invest in support systems, reduce workload sustainably",
                        effects: { financial: -15, reputation: 5, research: 5, staff: 20, student: 10, local: 5 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "First Budget Pressures",
                description: "Government announces potential funding cuts. Early projections show overspending. Treasury demands immediate action.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Open budget discussions with all stakeholders",
                        effects: { financial: -5, reputation: 10, research: 0, staff: 5, student: 5, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Cut underperforming departments, invest in winners",
                        effects: { financial: 15, reputation: 5, research: 10, staff: -15, student: -10, local: -5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Across-the-board efficiency savings",
                        effects: { financial: 20, reputation: 5, research: 0, staff: -10, student: -5, local: 0 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Protect services, seek alternative funding",
                        effects: { financial: -10, reputation: 5, research: 5, staff: 10, student: 15, local: 10 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Staff Workload Crisis",
                description: "Union complaint about 60+ hour weeks, double caseloads, spiking sick leave across departments.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Joint working groups to redesign roles collaboratively",
                        effects: { financial: -10, reputation: 5, research: -5, staff: 20, student: 5, local: 5 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Reward high performers, let others find their level",
                        effects: { financial: 5, reputation: 0, research: 10, staff: -20, student: -10, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Time management training and productivity monitoring",
                        effects: { financial: 5, reputation: -5, research: 0, staff: -15, student: -5, local: -5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Hire additional support, reduce individual workloads",
                        effects: { financial: -25, reputation: 5, research: 10, staff: 25, student: 15, local: 5 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Pandemic Reports",
                description: "Virus spreading internationally. Conflicting government advice. Students and parents nervous, international students considering leaving.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Crisis committee with representatives from all groups",
                        effects: { financial: -5, reputation: 10, research: 0, staff: 10, student: 15, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Continue normal operations - voluntary participation",
                        effects: { financial: 10, reputation: -15, research: 0, staff: -10, student: -15, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Evidence-based risk management protocols",
                        effects: { financial: 5, reputation: 15, research: 0, staff: 5, student: 5, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Health and safety above all other considerations",
                        effects: { financial: -15, reputation: 10, research: -5, staff: 15, student: 20, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Lockdown Chaos",
                description: "Government lockdown announced. Campus closed, online teaching overnight. Students demand fee reductions, staff struggle with tech, parents furious about 'Zoom University.'",
                choices: [
                    {
                        label: "Community Response",
                        description: "Collaborative emergency response - everyone helps everyone",
                        effects: { financial: -15, reputation: 10, research: -10, staff: 20, student: 15, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Sink or swim - adapt quickly or fall behind",
                        effects: { financial: 5, reputation: -10, research: 5, staff: -20, student: -25, local: -5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Rapid standardized online learning deployment",
                        effects: { financial: 10, reputation: 10, research: 0, staff: -5, student: -5, local: 0 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Individual support for every student and staff member",
                        effects: { financial: -30, reputation: 15, research: 5, staff: 25, student: 25, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Online Teaching Disaster",
                description: "Tech-savvy staff thriving, others struggling. Student engagement dropping, time zone issues, digital divide excluding poorer students.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Peer teaching networks - mutual support",
                        effects: { financial: -5, reputation: 5, research: -5, staff: 15, student: 10, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Best content wins - market forces determine quality",
                        effects: { financial: 10, reputation: 0, research: 10, staff: -10, student: -15, local: -5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Standardized platform, training, metrics",
                        effects: { financial: 15, reputation: 5, research: 0, staff: -10, student: -10, local: 0 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Individual support, flexible approaches, no one left behind",
                        effects: { financial: -20, reputation: 10, research: 5, staff: 10, student: 20, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Fee Revolt",
                description: "Mass student protests about full fees for online education. #RefundOurFees going viral. Parents threatening legal action. Next year enrollment uncertain.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Open negotiation with student representatives",
                        effects: { financial: -15, reputation: 10, research: 0, staff: 5, student: 20, local: 15 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Hold firm - education still being delivered",
                        effects: { financial: 20, reputation: -20, research: 0, staff: -10, student: -25, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Partial refunds with service level agreements",
                        effects: { financial: -5, reputation: 5, research: 0, staff: 0, student: 5, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Significant fee reduction - education is a right",
                        effects: { financial: -30, reputation: 20, research: 0, staff: 15, student: 30, local: 20 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Financial Shortfall Crisis",
                description: "Pandemic costs + fee refunds + reduced international enrollment = massive budget hole. Treasury warns of potential insolvency.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Transparent budget crisis meetings with all stakeholders",
                        effects: { financial: -5, reputation: 10, research: 0, staff: 10, student: 5, local: 15 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Emergency cuts to lowest-performing areas only",
                        effects: { financial: 25, reputation: 0, research: 5, staff: -20, student: -15, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Systematic restructuring based on financial data",
                        effects: { financial: 30, reputation: 5, research: 0, staff: -15, student: -10, local: -5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Protect jobs and services, seek emergency funding",
                        effects: { financial: -20, reputation: 15, research: 5, staff: 20, student: 15, local: 20 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Summer Planning Crisis",
                description: "September planning with zero certainty. Online? Hybrid? Face-to-face? Every decision involves massive commitments with no guarantees.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Scenario planning with entire campus community input",
                        effects: { financial: -10, reputation: 5, research: -5, staff: 15, student: 10, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Multiple competing plans - back the winners",
                        effects: { financial: 5, reputation: 5, research: 10, staff: -15, student: -5, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Data-driven decision making with clear metrics",
                        effects: { financial: 15, reputation: 10, research: 0, staff: 5, student: 5, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Plan for maximum flexibility to support all needs",
                        effects: { financial: -25, reputation: 10, research: 5, staff: 20, student: 20, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Staff Burnout Peak",
                description: "Critical staff exhaustion. Physical and mental health problems. Support staff overwhelmed. Union threatening strike over working conditions.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Collective support networks and shared workload",
                        effects: { financial: -10, reputation: 5, research: 5, staff: 25, student: 10, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Reward resilient performers, replace those who can't cope",
                        effects: { financial: 10, reputation: -5, research: 15, staff: -30, student: -15, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional wellbeing programs and efficiency improvements",
                        effects: { financial: 5, reputation: 5, research: 0, staff: 10, student: 0, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Comprehensive mental health support and workload reduction",
                        effects: { financial: -25, reputation: 10, research: 10, staff: 35, student: 15, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Redundancy Consultations",
                description: "Budget mathematics are brutal. Must cut staff costs to survive. Union demanding meetings, media investigating, affected staff devastated.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Democratic selection process with affected staff having voice",
                        effects: { financial: 15, reputation: 10, research: 0, staff: 5, student: 5, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Merit-based cuts - protect best, remove rest",
                        effects: { financial: 25, reputation: 0, research: 20, staff: -25, student: -10, local: -5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Objective criteria-based redundancies with professional process",
                        effects: { financial: 30, reputation: 5, research: 0, staff: -15, student: -5, local: -5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Voluntary severance and retraining before compulsory cuts",
                        effects: { financial: 5, reputation: 15, research: 5, staff: 15, student: 10, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },

            // YEAR 2: SCANDAL YEAR
            {
                title: "New Term Under Cloud",
                description: "New academic year begins with rock-bottom morale after summer redundancies. Remaining staff covering extra duties, increased class sizes, institution just surviving.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Rebuild morale through collaborative recovery planning",
                        effects: { financial: -10, reputation: 5, research: 5, staff: 15, student: 10, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Fresh start - recruit new talent and drive excellence",
                        effects: { financial: -15, reputation: 10, research: 15, staff: -10, student: 5, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Streamlined operations with clear performance expectations",
                        effects: { financial: 10, reputation: 5, research: 0, staff: -5, student: -5, local: 0 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Focus on healing and rebuilding community trust",
                        effects: { financial: -15, reputation: 10, research: 10, staff: 25, student: 20, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Morale at All-Time Low",
                description: "Staff satisfaction surveys reveal devastating results. Workload stress, job insecurity, colleague loss creating toxic atmosphere affecting teaching quality.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Create healing circles and peer support networks",
                        effects: { financial: -5, reputation: 5, research: 10, staff: 20, student: 15, local: 10 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Focus resources on high performers, let others leave",
                        effects: { financial: 15, reputation: -5, research: 10, staff: -20, student: -15, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional development and performance management",
                        effects: { financial: 5, reputation: 5, research: 0, staff: 5, student: 0, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Comprehensive wellbeing program and workload redistribution",
                        effects: { financial: -20, reputation: 10, research: 15, staff: 30, student: 25, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            // Adding more scenarios - continuing from Year 2
            {
                title: "Government Funding Cuts",
                description: "Government announces another 15% funding cut over two years, on top of existing pressures. Threatens any recovery being built.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Unite campus community to lobby against cuts together",
                        effects: { financial: -5, reputation: 15, research: 0, staff: 10, student: 10, local: 20 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Compete aggressively for remaining funding streams",
                        effects: { financial: 10, reputation: 5, research: 15, staff: -10, student: -5, local: -5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Diversify income streams, reduce government dependency",
                        effects: { financial: 20, reputation: 10, research: 0, staff: -5, student: -10, local: -5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Maintain educational quality despite reduced resources",
                        effects: { financial: -15, reputation: 10, research: 5, staff: 10, student: 15, local: 15 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Leaked Emails Scandal",
                description: "Internal emails about planned cuts leaked to press. Emails reveal senior management discussing department closures and staff targeting. Campus anger and suspicion explode.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Full transparency - publish all decision-making processes",
                        effects: { financial: -5, reputation: 20, research: 0, staff: 15, student: 10, local: 15 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Focus on leak source - discipline and move on",
                        effects: { financial: 5, reputation: -15, research: 0, staff: -20, student: -15, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional investigation, improved communication protocols",
                        effects: { financial: 5, reputation: 5, research: 0, staff: -5, student: -5, local: 0 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Acknowledge hurt caused, rebuild trust through actions",
                        effects: { financial: -10, reputation: 15, research: 10, staff: 25, student: 20, local: 20 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Senior Management Corruption Exposed",
                description: "Investigative journalists reveal financial irregularities. Contracts to friends, expense abuse, potential embezzlement. National news dominates, reputation severely damaged.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Immediate democratic oversight of all financial decisions",
                        effects: { financial: -15, reputation: 10, research: 0, staff: 20, student: 15, local: 20 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Replace corrupt individuals with high-caliber leaders",
                        effects: { financial: -20, reputation: 15, research: 10, staff: -5, student: 5, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional audit and governance reforms",
                        effects: { financial: 10, reputation: 20, research: 0, staff: 5, student: 5, local: 10 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Focus on healing community trust and rebuilding together",
                        effects: { financial: -20, reputation: 15, research: 15, staff: 25, student: 20, local: 25 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Political Protection Scandal",
                description: "UK Prime Minister offered honors to protect university scandal figures. Massive political firestorm. Institution at center of national corruption story involving highest government levels.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Stand with affected staff and students against political corruption",
                        effects: { financial: -10, reputation: 25, research: 0, staff: 30, student: 25, local: 30 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Distance institution from scandal, focus on excellence",
                        effects: { financial: 5, reputation: -10, research: 10, staff: -15, student: 0, local: -10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional crisis management and reputation protection",
                        effects: { financial: 10, reputation: 15, research: 0, staff: 0, student: -5, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Support all community members affected by scandal",
                        effects: { financial: -25, reputation: 20, research: 10, staff: 35, student: 30, local: 35 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Staff and Student Protests",
                description: "Accumulated stress explodes into campus-wide protests. Students and staff unite demanding change, better conditions, accountability. National media attention, additional leadership pressure.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Join protests - leadership stands with community",
                        effects: { financial: -15, reputation: 20, research: 0, staff: 35, student: 30, local: 30 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Let protests burn out while focusing on high performers",
                        effects: { financial: 10, reputation: -15, research: 5, staff: -25, student: -30, local: -20 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional mediation and structured negotiation",
                        effects: { financial: 5, reputation: 10, research: 0, staff: 10, student: 10, local: 10 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Listen deeply, commit to fundamental change",
                        effects: { financial: -30, reputation: 25, research: 15, staff: 40, student: 35, local: 40 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Scottish Government Intervention",
                description: "Scottish Government announces emergency intervention to save jobs and maintain educational provision. Welcome financial relief but loss of institutional autonomy. Government representatives oversee major decisions.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Embrace government partnership for democratic accountability",
                        effects: { financial: 25, reputation: 10, research: 0, staff: 20, student: 15, local: 25 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Negotiate maximum institutional independence",
                        effects: { financial: 15, reputation: 5, research: 10, staff: 5, student: 0, local: 5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional partnership with clear governance structures",
                        effects: { financial: 30, reputation: 15, research: 0, staff: 15, student: 10, local: 20 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Grateful acceptance focused on serving educational mission",
                        effects: { financial: 20, reputation: 15, research: 15, staff: 25, student: 20, local: 30 },
                        culture: "nurturing"
                    }
                ]
            },

            // YEAR 3: ROAD TO RECOVERY
            {
                title: "New Leadership Question",
                description: "New academic year begins with leadership question. Bring in new management, promote from within, or maintain continuity? Choice signals recovery direction and determines stakeholder confidence.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Democratically elect new leadership from community",
                        effects: { financial: -5, reputation: 15, research: 10, staff: 25, student: 20, local: 20 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Recruit high-profile external leader to drive excellence",
                        effects: { financial: -15, reputation: 25, research: 20, staff: -10, student: 5, local: 0 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional headhunting for experienced manager",
                        effects: { financial: 15, reputation: 15, research: 0, staff: 5, student: 5, local: 5 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Promote caring leaders who understand community needs",
                        effects: { financial: 5, reputation: 15, research: 15, staff: 30, student: 25, local: 25 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "First Positive Media Coverage",
                description: "After months of negative press, first genuinely positive stories appear. How institution handles this turning point influences whether positive momentum continues or stalls.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Share credit widely across entire campus community",
                        effects: { financial: 5, reputation: 15, research: 15, staff: 30, student: 25, local: 25 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Leverage success to attract more high performers",
                        effects: { financial: 15, reputation: 20, research: 25, staff: 5, student: 10, local: 5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Strategic communication to maximize positive impact",
                        effects: { financial: 20, reputation: 35, research: 0, staff: 10, student: 10, local: 15 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Use positive attention to highlight educational mission",
                        effects: { financial: 5, reputation: 25, research: 25, staff: 25, student: 30, local: 30 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Quality Inspection Arrives",
                description: "External quality inspectors arrive for comprehensive review of teaching, research, and governance. First major external validation since crisis, results will significantly influence future reputation and funding.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Showcase collaborative achievements and democratic governance",
                        effects: { financial: 10, reputation: 25, research: 20, staff: 25, student: 20, local: 25 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Highlight individual excellence and competitive achievements",
                        effects: { financial: 15, reputation: 30, research: 35, staff: 10, student: 15, local: 5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional presentation of systematic improvements",
                        effects: { financial: 25, reputation: 40, research: 15, staff: 15, student: 15, local: 15 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Demonstrate commitment to holistic student development",
                        effects: { financial: 10, reputation: 30, research: 30, staff: 30, student: 40, local: 30 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Staff Retention Success",
                description: "Summer brings annual academic job movements. Whether university can retain key staff and attract new talent indicates recovery success and influences final year prospects.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Collective commitment to staying and building together",
                        effects: { financial: 20, reputation: 15, research: 25, staff: 35, student: 20, local: 25 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Competitive packages to retain and attract stars",
                        effects: { financial: -15, reputation: 30, research: 40, staff: 10, student: 15, local: 5 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Strategic retention based on institutional priorities",
                        effects: { financial: 25, reputation: 15, research: 20, staff: 15, student: 10, local: 10 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Comprehensive support for all staff development and wellbeing",
                        effects: { financial: -10, reputation: 20, research: 35, staff: 45, student: 30, local: 30 },
                        culture: "nurturing"
                    }
                ]
            },

            // YEAR 4: BACK ON TOP?
            {
                title: "Fresh Start or Same Old Problems?",
                description: "Final academic year begins with question of whether genuine transformation occurred or institution simply returned to pre-crisis patterns. Early indicators set expectations for year ahead.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Celebrate transformation while staying vigilant about democratic values",
                        effects: { financial: 15, reputation: 25, research: 20, staff: 30, student: 25, local: 30 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Ambitious drive for sector leadership and excellence",
                        effects: { financial: 25, reputation: 40, research: 35, staff: 15, student: 15, local: 10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professional assessment of transformation and strategic next steps",
                        effects: { financial: 35, reputation: 30, research: 20, staff: 20, student: 20, local: 20 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Genuine transformation rooted in caring community values",
                        effects: { financial: 20, reputation: 30, research: 35, staff: 40, student: 40, local: 40 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Research Funding Results",
                description: "Major research funding decisions announced, providing crucial test of whether academic community has genuinely recovered research excellence and external confidence in institution.",
                choices: [
                    {
                        label: "Community Response",
                        description: "Collaborative research success shared across community",
                        effects: { financial: 30, reputation: 25, research: 40, staff: 35, student: 20, local: 30 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Star researchers achieve breakthrough funding success",
                        effects: { financial: 40, reputation: 40, research: 50, staff: 10, student: 15, local: 10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Strategic research portfolio achieves systematic funding success",
                        effects: { financial: 45, reputation: 35, research: 35, staff: 20, student: 15, local: 20 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Mission-driven research addressing community and global needs",
                        effects: { financial: 25, reputation: 30, research: 45, staff: 35, student: 30, local: 35 },
                        culture: "nurturing"
                    }
                ]
            },
            {
                title: "Final Assessment",
                description: "Final scenario asks fundamental question about institutional transformation. What kind of institution has been built through four years of crisis and recovery choices?",
                choices: [
                    {
                        label: "Community Response",
                        description: "Democratic institution serving community needs through collaborative governance",
                        effects: { financial: 10, reputation: 25, research: 25, staff: 40, student: 35, local: 45 },
                        culture: "community"
                    },
                    {
                        label: "Individualistic Response",
                        description: "Excellence-driven institution achieving competitive sector leadership",
                        effects: { financial: 30, reputation: 45, research: 40, staff: 15, student: 20, local: 10 },
                        culture: "individualistic"
                    },
                    {
                        label: "Corporate Response",
                        description: "Professionally managed institution delivering systematic educational services",
                        effects: { financial: 40, reputation: 30, research: 30, staff: 25, student: 25, local: 20 },
                        culture: "corporate"
                    },
                    {
                        label: "Nurturing Response",
                        description: "Caring institution prioritizing human flourishing and community service",
                        effects: { financial: 20, reputation: 35, research: 35, staff: 45, student: 50, local: 50 },
                        culture: "nurturing"
                    }
                ]
            }
        ];

        function checkForCrisisInterrupt() {
            console.log("Checking for crisis interrupt...");
            console.log("Current metrics:", gameState.metrics);
            
            // Check if any metric has hit the red zone and needs crisis intervention
            const crisisMetrics = [];
            
            Object.keys(gameState.metrics).forEach(metric => {
                console.log(`Checking ${metric}: ${gameState.metrics[metric]} < 40? ${gameState.metrics[metric] < 40}`);
                console.log(`Crisis scenario exists for ${metric}?`, !!crisisScenarios[metric]);
                
                if (gameState.metrics[metric] < 40 && crisisScenarios[metric]) {
                    crisisMetrics.push(metric);
                    console.log(`Added ${metric} to crisis list`);
                }
            });
            
            console.log("Crisis metrics found:", crisisMetrics);
            
            // If multiple crises, prioritize by severity
            if (crisisMetrics.length > 0) {
                const priorityOrder = ['financial', 'staff', 'student', 'reputation', 'research', 'local'];
                const selectedCrisis = crisisMetrics.sort((a, b) => 
                    priorityOrder.indexOf(a) - priorityOrder.indexOf(b)
                )[0];
                
                console.log("Selected crisis:", selectedCrisis);
                return selectedCrisis;
            }
            
            console.log("No crisis detected");
            return null;
        }

        function displayCrisisScenario(crisisType) {
            console.log("Displaying crisis scenario for:", crisisType);
            console.log("Crisis scenario data:", crisisScenarios[crisisType]);
            
            const crisis = crisisScenarios[crisisType];
            
            if (!crisis) {
                console.error("No crisis scenario found for type:", crisisType);
                return;
            }
            
            const scenarioHTML = `
                <div class="scenario-title" style="color: #ff6666;">üö® ${crisis.title} üö®</div>
                <div class="scenario-description" style="border: 2px solid #ff6666; padding: 15px; background-color: #1a0000;">
                    ${crisis.description}
                </div>
                <div class="choices">
                    ${crisis.choices.map((choice, index) => `
                        <button class="choice-button" onclick="makeCrisisChoice('${crisisType}', ${index})" style="border-color: #ff6666;">
                            <div class="choice-label">${choice.label}</div>
                            <div>${choice.description}</div>
                        </button>
                    `).join('')}
                </div>
            `;
            
            console.log("Setting crisis scenario HTML");
            const scenarioContainer = document.getElementById('scenario-container');
            if (scenarioContainer) {
                scenarioContainer.innerHTML = scenarioHTML;
                console.log("Crisis scenario HTML set successfully");
            } else {
                console.error("Could not find scenario-container element");
            }
        }

        function makeCrisisChoice(crisisType, choiceIndex) {
            const crisis = crisisScenarios[crisisType];
            const choice = crisis.choices[choiceIndex];
            
            // Track cultural choice
            gameState.culturalChoices[choice.culture]++;
            
            // Apply effects
            const oldMetrics = {...gameState.metrics};
            Object.keys(choice.effects).forEach(metric => {
                gameState.metrics[metric] = Math.max(0, Math.min(100, gameState.metrics[metric] + choice.effects[metric]));
            });
            
            // Apply cascade effects
            const cascadeMessage = applyCascadeEffects();
            const positiveMessage = applyPositiveCascades();
            
            // Update display
            updateAllMetrics();
            recordMetricsInHistory();
            
            // Show results with crisis context
            showCrisisResults(choice, oldMetrics, cascadeMessage + positiveMessage, crisisType);
        }

        function showCrisisResults(choice, oldMetrics, cascadeMessage, crisisType) {
            const triggers = checkTriggers(oldMetrics);
            
            let resultsHTML = `
                <div class="results" style="border-color: #ff6666;">
                    <div class="results-title" style="color: #ff6666;">üö® CRISIS RESPONSE: ${choice.label}</div>
                    <div style="margin-bottom: 15px; font-style: italic; color: #ffcccc;">"${choice.description}"</div>
            `;
            
            // Show metric changes
            Object.keys(choice.effects).forEach(metric => {
                const change = choice.effects[metric];
                const oldValue = oldMetrics[metric];
                const newValue = gameState.metrics[metric];
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const changeStr = change > 0 ? `+${change}` : `${change}`;
                
                resultsHTML += `
                    <div class="metric-change">
                        ${metric.charAt(0).toUpperCase() + metric.slice(1)}: ${oldValue} ‚Üí ${newValue} <span class="${changeClass}">(${changeStr})</span>
                    </div>
                `;
            });
            
            if (cascadeMessage) {
                resultsHTML += `<div style="margin-top: 15px; color: #ffff00;">${cascadeMessage}</div>`;
            }
            
            if (triggers.length > 0) {
                resultsHTML += `
                    <div class="triggers">
                        <div class="triggers-title">‚ö†Ô∏è TRIGGERED EVENTS:</div>
                        ${triggers.map(trigger => `<div>‚Ä¢ ${trigger}</div>`).join('')}
                    </div>
                `;
            }
            
            resultsHTML += `
                <div style="margin-top: 15px; padding: 10px; background-color: #0a0a1a; border-radius: 5px;">
                    <strong style="color: #ff9999;">Crisis Status:</strong> 
                    ${gameState.metrics[crisisType] >= 40 ? 
                        '<span style="color: #00ff00;">Crisis resolved - back to normal operations</span>' : 
                        '<span style="color: #ff6666;">Still in crisis - further intervention may be needed</span>'
                    }
                </div>
                <button class="continue-button" onclick="nextScenario()">Continue Campus Management</button>
            `;
            
            document.getElementById('results-container').innerHTML = resultsHTML;
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('scenario-container').style.display = 'none';
        }
        function getMetricZone(value) {
            if (value >= 70) return "green";
            if (value >= 40) return "yellow";
            return "red";
        }

        function updateMetricDisplay(metricId, value) {
            const element = document.getElementById(metricId + '-value');
            element.textContent = value;
            element.className = 'metric-value ' + getMetricZone(value);
            
            // Update trend line
            updateTrendLine(metricId);
        }

        function updateTrendLine(metricId) {
            const history = gameState.metricsHistory[metricId];
            const pathElement = document.getElementById(metricId + '-path');
            
            if (!pathElement || history.length < 1) {
                console.log(`Could not find path element for ${metricId} or no history`);
                return;
            }
            
            // Create points for the trend line (max 8 points to fit in 60px width)
            const maxPoints = 8;
            const recentHistory = history.slice(-maxPoints);
            const width = 60;
            const height = 20;
            
            console.log(`Updating trend for ${metricId}:`, recentHistory);
            
            if (recentHistory.length === 1) {
                // Single point - draw horizontal line (neutral color)
                const y = height - ((recentHistory[0] / 100) * height);
                const points = `0,${y} ${width},${y}`;
                pathElement.setAttribute('points', points);
                pathElement.setAttribute('class', 'trend-path yellow');
                console.log(`Single point for ${metricId}: ${points} - set to yellow`);
            } else {
                // Multiple points - draw connecting line
                let points = recentHistory.map((value, index) => {
                    const x = (index / (recentHistory.length - 1)) * width;
                    const y = height - ((value / 100) * height);
                    return `${x},${y}`;
                }).join(' ');
                
                pathElement.setAttribute('points', points);
                console.log(`Multiple points for ${metricId}: ${points}`);
                
                // Color based on trend direction between most recent decision points
                const currentValue = recentHistory[recentHistory.length - 1];
                const previousValue = recentHistory[recentHistory.length - 2];
                const trend = currentValue - previousValue;
                
                let colorClass = '';
                if (trend > 0) {
                    colorClass = 'trend-path green';
                    console.log(`${metricId} trending UP: ${previousValue} ‚Üí ${currentValue} (+${trend}) - setting GREEN`);
                } else if (trend < 0) {
                    colorClass = 'trend-path red';
                    console.log(`${metricId} trending DOWN: ${previousValue} ‚Üí ${currentValue} (${trend}) - setting RED`);
                } else {
                    colorClass = 'trend-path yellow';
                    console.log(`${metricId} STABLE: ${previousValue} ‚Üí ${currentValue} (${trend}) - setting YELLOW`);
                }
                
                // Force the class change
                pathElement.setAttribute('class', colorClass);
                
                // Double-check it was applied
                console.log(`Final class for ${metricId}:`, pathElement.getAttribute('class'));
            }
        }

        function updateAllMetrics() {
            // Update displays first
            updateMetricDisplay('financial', gameState.metrics.financial);
            updateMetricDisplay('reputation', gameState.metrics.reputation);
            updateMetricDisplay('research', gameState.metrics.research);
            updateMetricDisplay('staff', gameState.metrics.staff);
            updateMetricDisplay('student', gameState.metrics.student);
            updateMetricDisplay('local', gameState.metrics.local);
        }
        
        function recordMetricsInHistory() {
            // Store current values in history after effects are applied
            Object.keys(gameState.metrics).forEach(metric => {
                gameState.metricsHistory[metric].push(gameState.metrics[metric]);
                // Keep only last 10 values to prevent memory issues
                if (gameState.metricsHistory[metric].length > 10) {
                    gameState.metricsHistory[metric].shift();
                }
            });
            
            // Update trend lines after recording history
            Object.keys(gameState.metrics).forEach(metric => {
                updateTrendLine(metric);
            });
        }

        function checkTriggers(oldMetrics) {
            const triggers = [];
            const metricNames = {
                financial: "Financial",
                reputation: "Reputation", 
                research: "Research Quality",
                staff: "Staff Morale",
                student: "Student Satisfaction",
                local: "Local Impact"
            };

            Object.keys(gameState.metrics).forEach(metric => {
                const currentValue = gameState.metrics[metric];
                const oldValue = oldMetrics[metric];
                const change = currentValue - oldValue;
                const currentZone = getMetricZone(currentValue);
                const oldZone = getMetricZone(oldValue);
                
                // Only show triggers for yellow and red zones
                if (currentZone === "yellow" || currentZone === "red") {
                    let statusText = "";
                    let changeText = "";
                    
                    // Determine if zone changed
                    if (oldZone !== currentZone) {
                        if (currentZone === "yellow") {
                            statusText = "THREAT: Entered yellow zone";
                        } else if (currentZone === "red") {
                            statusText = "CRISIS: Entered red zone";
                        }
                    } else {
                        // Same zone, show current status
                        if (currentZone === "yellow") {
                            statusText = "THREAT: In yellow zone";
                        } else if (currentZone === "red") {
                            statusText = "CRISIS: In red zone";
                        }
                    }
                    
                    // Add change indicator
                    if (change > 0) {
                        changeText = ` (${currentValue}, +${change})`;
                    } else if (change < 0) {
                        changeText = ` (${currentValue}, ${change})`;
                    } else {
                        changeText = ` (${currentValue}, no change)`;
                    }
                    
                    const icon = currentZone === "red" ? "üö®" : "‚ö†Ô∏è";
                    triggers.push(`${icon} ${metricNames[metric]} ${statusText}${changeText}`);
                }
            });

            return triggers;
        }

        function applyCascadeEffects() {
            let cascadeMessage = "";
            
            // Apply penalties for yellow and red zones
            Object.keys(gameState.metrics).forEach(metric => {
                const value = gameState.metrics[metric];
                
                if (value < 40) { // Red zone cascades
                    switch(metric) {
                        case 'staff':
                            // Unhappy staff affects everything
                            gameState.metrics.student = Math.max(0, gameState.metrics.student - 4);
                            gameState.metrics.research = Math.max(0, gameState.metrics.research - 4);
                            gameState.metrics.reputation = Math.max(0, gameState.metrics.reputation - 3);
                            cascadeMessage += "üí• Staff crisis destroying teaching quality and research output! ";
                            break;
                        case 'student':
                            // Unhappy students damage reputation and finances
                            gameState.metrics.reputation = Math.max(0, gameState.metrics.reputation - 4);
                            gameState.metrics.financial = Math.max(0, gameState.metrics.financial - 3);
                            cascadeMessage += "üí• Student dissatisfaction damaging reputation and enrollment! ";
                            break;
                        case 'reputation':
                            // Poor reputation affects finances and staff retention
                            gameState.metrics.financial = Math.max(0, gameState.metrics.financial - 4);
                            gameState.metrics.staff = Math.max(0, gameState.metrics.staff - 3);
                            cascadeMessage += "üí• Reputation collapse affecting funding and staff retention! ";
                            break;
                        case 'financial':
                            // Financial crisis affects everything severely
                            Object.keys(gameState.metrics).forEach(otherMetric => {
                                if (otherMetric !== 'financial') {
                                    gameState.metrics[otherMetric] = Math.max(0, gameState.metrics[otherMetric] - 6);
                                }
                            });
                            cascadeMessage += "üí• Financial collapse destroying all operations! ";
                            break;
                        case 'research':
                            // Poor research affects reputation and staff morale
                            gameState.metrics.reputation = Math.max(0, gameState.metrics.reputation - 3);
                            gameState.metrics.staff = Math.max(0, gameState.metrics.staff - 2);
                            cascadeMessage += "üí• Research failure damaging institutional credibility! ";
                            break;
                        case 'local':
                            // Poor community relations affect reputation and finances
                            gameState.metrics.reputation = Math.max(0, gameState.metrics.reputation - 2);
                            gameState.metrics.financial = Math.max(0, gameState.metrics.financial - 2);
                            cascadeMessage += "üí• Community backlash affecting public support! ";
                            break;
                    }
                } else if (value >= 40 && value < 70) { // Yellow zone cascades (milder)
                    switch(metric) {
                        case 'staff':
                            gameState.metrics.student = Math.max(0, gameState.metrics.student - 2);
                            gameState.metrics.research = Math.max(0, gameState.metrics.research - 1);
                            cascadeMessage += "‚ö†Ô∏è Staff concerns affecting teaching quality. ";
                            break;
                        case 'student':
                            gameState.metrics.reputation = Math.max(0, gameState.metrics.reputation - 2);
                            gameState.metrics.financial = Math.max(0, gameState.metrics.financial - 1);
                            cascadeMessage += "‚ö†Ô∏è Student dissatisfaction affecting reputation. ";
                            break;
                        case 'reputation':
                            gameState.metrics.financial = Math.max(0, gameState.metrics.financial - 2);
                            cascadeMessage += "‚ö†Ô∏è Reputation concerns affecting funding. ";
                            break;
                    }
                }
            });

            return cascadeMessage;
        }

        function checkForGameOver() {
            // Multiple failure conditions
            
            // Condition 1: Multiple critical failures
            const redZoneMetrics = Object.keys(gameState.metrics).filter(metric => gameState.metrics[metric] < 40);
            if (redZoneMetrics.length >= 4) {
                return {
                    type: "institutional_collapse",
                    message: "The university has collapsed under multiple critical failures. Too many systems have failed simultaneously.",
                    details: `Critical failures in: ${redZoneMetrics.join(', ')}`
                };
            }
            
            // Condition 2: Financial insolvency
            if (gameState.metrics.financial <= 10) {
                return {
                    type: "bankruptcy",
                    message: "The university has declared bankruptcy. Operations cannot continue without funding.",
                    details: `Financial strength: ${gameState.metrics.financial}`
                };
            }
            
            // Condition 3: Complete staff exodus
            if (gameState.metrics.staff <= 5) {
                return {
                    type: "staff_exodus",
                    message: "Mass staff exodus has left the university unable to operate. There are no longer enough employees to function.",
                    details: `Staff morale: ${gameState.metrics.staff}`
                };
            }
            
            // Condition 4: Student boycott
            if (gameState.metrics.student <= 5) {
                return {
                    type: "student_boycott",
                    message: "Student satisfaction is so low that enrollment has collapsed. The university cannot survive without students.",
                    details: `Student satisfaction: ${gameState.metrics.student}`
                };
            }
            
            // Condition 5: Sustained crisis (any metric in red for too long)
            // Check if we've been stuck in crisis loops for too many months
            const currentCrisis = findActiveCrisis();
            if (currentCrisis && crisisHistory[currentCrisis] !== undefined) {
                // If we've had the same crisis for multiple months without significant improvement
                const sustainedCrisisMonths = gameState.sustainedCrisis || {};
                sustainedCrisisMonths[currentCrisis] = (sustainedCrisisMonths[currentCrisis] || 0) + 1;
                gameState.sustainedCrisisMonths = sustainedCrisisMonths;
                
                if (sustainedCrisisMonths[currentCrisis] >= 6) {
                    return {
                        type: "sustained_crisis",
                        message: `The ${currentCrisis} crisis has persisted for too long. The institution can no longer recover from prolonged failure.`,
                        details: `${currentCrisis} has been in crisis for ${sustainedCrisisMonths[currentCrisis]} months`
                    };
                }
            }
            
            return null; // No game over condition met
        }

        function showGameOver(gameOverInfo) {
            const gameOverHTML = `
                <div class="scenario" style="border: 3px solid #ff0000; background-color: #330000;">
                    <div class="scenario-title" style="color: #ff0000; font-size: 24px; text-align: center;">
                        üíÄ GAME OVER üíÄ
                    </div>
                    <div class="scenario-description" style="color: #ffcccc; text-align: center; padding: 30px;">
                        <h3 style="color: #ff6666;">${gameOverInfo.type.replace(/_/g, ' ').toUpperCase()}</h3>
                        <p style="font-size: 18px; margin: 20px 0;">${gameOverInfo.message}</p>
                        <p style="color: #ff9999;">${gameOverInfo.details}</p>
                        
                        <div style="margin: 30px 0; padding: 20px; background-color: #1a0000; border-radius: 10px;">
                            <h4 style="color: #ffff00;">Your Final Metrics:</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                                ${Object.keys(gameState.metrics).map(metric => `
                                    <div style="color: ${getMetricZone(gameState.metrics[metric]) === 'red' ? '#ff6666' : getMetricZone(gameState.metrics[metric]) === 'yellow' ? '#ffff00' : '#00ff00'};">
                                        ${metric.charAt(0).toUpperCase() + metric.slice(1)}: ${gameState.metrics[metric]}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin: 30px 0; padding: 20px; background-color: #0a0a1a; border-radius: 10px;">
                            <h4 style="color: #00ffff;">Your Management Philosophy:</h4>
                            <div style="color: #cccccc;">
                                ${Object.keys(gameState.culturalChoices).map(culture => 
                                    `${culture.charAt(0).toUpperCase() + culture.slice(1)}: ${gameState.culturalChoices[culture]} choices`
                                ).join('<br>')}
                            </div>
                        </div>
                        
                        <p style="color: #ffff00; font-style: italic;">
                            Every choice has consequences. In economics, as in institutional management, 
                            sustainable success requires balancing competing priorities and managing trade-offs wisely.
                        </p>
                        
                        <button class="continue-button" onclick="location.reload()" 
                                style="background-color: #660000; border-color: #ff0000; margin-top: 20px;">
                            Try Again
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('scenario-container').innerHTML = gameOverHTML;
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('scenario-container').style.display = 'block';
        }

        function applyPositiveCascades() {
            let cascadeMessage = "";
            
            // High staff morale benefits
            if (gameState.metrics.staff >= 80) {
                gameState.metrics.student = Math.min(100, gameState.metrics.student + 2);
                gameState.metrics.research = Math.min(100, gameState.metrics.research + 2);
                cascadeMessage += "‚ú® High staff morale boosting teaching and research! ";
            }
            
            // High student satisfaction benefits
            if (gameState.metrics.student >= 80) {
                gameState.metrics.reputation = Math.min(100, gameState.metrics.reputation + 2);
                gameState.metrics.financial = Math.min(100, gameState.metrics.financial + 3);
                cascadeMessage += "‚ú® Happy students boosting reputation and enrollment! ";
            }
            
            // Community synergy bonus
            if (gameState.metrics.staff >= 75 && gameState.metrics.student >= 75 && gameState.metrics.local >= 60) {
                gameState.metrics.reputation = Math.min(100, gameState.metrics.reputation + 3);
                gameState.metrics.financial = Math.min(100, gameState.metrics.financial + 2);
                cascadeMessage += "‚ú® COMMUNITY SYNERGY: Strong culture attracting external support! ";
            }

            return cascadeMessage;
        }

        function startGame() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            
            // Move all the game content into the game screen
            const gameContent = `
                <div class="title">üèõÔ∏è CAMPUS SIMULATOR üèõÔ∏è</div>
                
                <div class="game-info">
                    <div>Month: <span id="current-month">September</span> | Year: <span id="current-year">1</span></div>
                    <div>Scenario: <span id="scenario-count">1</span> of 30</div>
                </div>
                
                <div class="metrics-display">
                    <div class="metric">
                        <span class="metric-name">Financial:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="financial-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="financial-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="financial-value">60</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Reputation:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="reputation-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="reputation-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="reputation-value">65</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Research:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="research-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="research-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="research-value">70</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Staff Morale:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="staff-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="staff-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="staff-value">55</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Students:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="student-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="student-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="student-value">60</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-name">Local Impact:</span>
                        <div class="metric-info">
                            <svg class="trend-line" id="local-trend" viewBox="0 0 60 20" preserveAspectRatio="none">
                                <polyline class="trend-path yellow" id="local-path" points=""></polyline>
                            </svg>
                            <span class="metric-value" id="local-value">50</span>
                        </div>
                    </div>
                </div>
                
                <div class="scenario" id="scenario-container">
                    <!-- Scenario content will be inserted here -->
                </div>
                
                <div id="results-container" style="display: none;">
                    <!-- Results will be shown here -->
                </div>
            `;
            
            document.getElementById('game-screen').innerHTML = gameContent;
            
            // Initialize game
            updateAllMetrics();
            
            // Initialize trend lines with starting values
            Object.keys(gameState.metrics).forEach(metric => {
                updateTrendLine(metric);
            });
            
            displayScenario();
        }

        function displayScenario() {
            if (gameState.currentScenario >= scenarios.length) {
                // Game complete - show final results
                const dominantCulture = Object.keys(gameState.culturalChoices).reduce((a, b) => 
                    gameState.culturalChoices[a] > gameState.culturalChoices[b] ? a : b
                );
                
                document.getElementById('scenario-container').innerHTML = `
                    <div class="scenario-title">üéì Campus Transformation Complete! üéì</div>
                    <div class="scenario-description">
                        Congratulations! You've guided your university through four years of crisis and transformation.
                        <br><br>
                        <strong style="color: #00ffff;">Your Management Philosophy:</strong><br>
                        Primary approach: <strong style="color: #ffff00;">${dominantCulture.charAt(0).toUpperCase() + dominantCulture.slice(1)}</strong>
                        <br><br>
                        <strong style="color: #00ffff;">Cultural Choice Distribution:</strong><br>
                        Community: ${gameState.culturalChoices.community} choices<br>
                        Individualistic: ${gameState.culturalChoices.individualistic} choices<br>
                        Corporate: ${gameState.culturalChoices.corporate} choices<br>
                        Nurturing: ${gameState.culturalChoices.nurturing} choices
                        <br><br>
                        <strong style="color: #00ffff;">Final Institution Profile:</strong><br>
                        Look at your metrics and trend lines above to see what kind of university you've created!
                        <br><br>
                        <em style="color: #888888;">In the full game, this would include detailed victory assessment based on your chosen cultural path and whether you achieved sustainable success.</em>
                    </div>
                `;
                return;
            }

            const scenario = scenarios[gameState.currentScenario];
            const scenarioHTML = `
                <div class="scenario-title">${scenario.title}</div>
                <div class="scenario-description">${scenario.description}</div>
                <div class="choices">
                    ${scenario.choices.map((choice, index) => `
                        <button class="choice-button" onclick="makeChoice(${index})">
                            <div class="choice-label">${choice.label}</div>
                            <div>${choice.description}</div>
                        </button>
                    `).join('')}
                </div>
            `;
            document.getElementById('scenario-container').innerHTML = scenarioHTML;
        }

        function makeChoice(choiceIndex) {
            const scenario = scenarios[gameState.currentScenario];
            const choice = scenario.choices[choiceIndex];
            
            // Track cultural choice
            gameState.culturalChoices[choice.culture]++;
            
            // Apply effects
            const oldMetrics = {...gameState.metrics};
            Object.keys(choice.effects).forEach(metric => {
                gameState.metrics[metric] = Math.max(0, Math.min(100, gameState.metrics[metric] + choice.effects[metric]));
            });
            
            // Apply cascade effects
            const cascadeMessage = applyCascadeEffects();
            const positiveMessage = applyPositiveCascades();
            
            // Update display
            updateAllMetrics();
            
            // Record metrics in history for trend lines
            recordMetricsInHistory();
            
            // Show results
            showResults(choice, oldMetrics, cascadeMessage + positiveMessage);
        }

        function showResults(choice, oldMetrics, cascadeMessage) {
            const triggers = checkTriggers(oldMetrics);
            
            let resultsHTML = `
                <div class="results">
                    <div class="results-title">Results: ${choice.label}</div>
                    <div style="margin-bottom: 15px; font-style: italic;">"${choice.description}"</div>
            `;
            
            // Show metric changes
            Object.keys(choice.effects).forEach(metric => {
                const change = choice.effects[metric];
                const oldValue = oldMetrics[metric];
                const newValue = gameState.metrics[metric];
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const changeStr = change > 0 ? `+${change}` : `${change}`;
                
                resultsHTML += `
                    <div class="metric-change">
                        ${metric.charAt(0).toUpperCase() + metric.slice(1)}: ${oldValue} ‚Üí ${newValue} <span class="${changeClass}">(${changeStr})</span>
                    </div>
                `;
            });
            
            if (cascadeMessage) {
                resultsHTML += `<div style="margin-top: 15px; color: #ffff00;">${cascadeMessage}</div>`;
            }
            
            if (triggers.length > 0) {
                resultsHTML += `
                    <div class="triggers">
                        <div class="triggers-title">‚ö†Ô∏è TRIGGERED EVENTS:</div>
                        ${triggers.map(trigger => `<div>‚Ä¢ ${trigger}</div>`).join('')}
                    </div>
                `;
            }
            
            resultsHTML += `
                    <button class="continue-button" onclick="nextScenario()">Continue to Next Month</button>
                </div>
            `;
            
            document.getElementById('results-container').innerHTML = resultsHTML;
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('scenario-container').style.display = 'none';
        }

        function makeChoice(choiceIndex) {
            const scenario = scenarios[gameState.currentScenario];
            const choice = scenario.choices[choiceIndex];
            
            // Track cultural choice
            gameState.culturalChoices[choice.culture]++;
            
            // Apply effects
            const oldMetrics = {...gameState.metrics};
            Object.keys(choice.effects).forEach(metric => {
                gameState.metrics[metric] = Math.max(0, Math.min(100, gameState.metrics[metric] + choice.effects[metric]));
            });
            
            // Apply cascade effects
            const cascadeMessage = applyCascadeEffects();
            const positiveMessage = applyPositiveCascades();
            
            // Update display and record in history
            updateAllMetrics();
            recordMetricsInHistory();
            
            // Auto-save after choice
            autoSave();
            
            // Show results
            showResults(choice, oldMetrics, cascadeMessage + positiveMessage);
        }

        function handleCrisisChoice(crisisType, choiceIndex) {
            console.log("HANDLING CRISIS CHOICE:", crisisType, choiceIndex);
            
            // Record the current value before applying effects
            const valueBeforeChoice = gameState.metrics[crisisType];
            console.log(`Recording ${crisisType} value before choice:`, valueBeforeChoice);
            
            const crisis = crisisScenarios[crisisType];
            const choice = crisis.choices[choiceIndex];
            
            // Track cultural choice
            gameState.culturalChoices[choice.culture]++;
            
            // Apply effects
            const oldMetrics = {...gameState.metrics};
            Object.keys(choice.effects).forEach(metric => {
                gameState.metrics[metric] = Math.max(0, Math.min(100, gameState.metrics[metric] + choice.effects[metric]));
            });
            
            // Apply cascade effects
            const cascadeMessage = applyCascadeEffects();
            const positiveMessage = applyPositiveCascades();
            
            // Update display and record in history
            updateAllMetrics();
            recordMetricsInHistory();
            
            // Auto-save after crisis choice
            autoSave();
            
            // Record the crisis value for comparison next time
            crisisHistory[crisisType] = gameState.metrics[crisisType];
            console.log(`Updated crisis history for ${crisisType}:`, crisisHistory[crisisType]);
            
            // Check if crisis is resolved (above 40) or improved
            const crisisResolved = gameState.metrics[crisisType] >= 40;
            const crisisImproved = gameState.metrics[crisisType] > valueBeforeChoice;
            
            console.log("Crisis resolved?", crisisResolved, `(${crisisType} = ${gameState.metrics[crisisType]})`);
            console.log("Crisis improved?", crisisImproved, `(${valueBeforeChoice} ‚Üí ${gameState.metrics[crisisType]})`);
            
            if (crisisResolved) {
                activeCrisis = null; // Clear active crisis
                delete crisisHistory[crisisType]; // Clear history
                console.log("Crisis fully resolved - clearing history");
            }
            
            // Show crisis results
            showCrisisResults(choice, oldMetrics, cascadeMessage + positiveMessage, crisisType, crisisResolved, crisisImproved);
        }

        function showResults(choice, oldMetrics, cascadeMessage) {
            const triggers = checkTriggers(oldMetrics);
            
            let resultsHTML = `
                <div class="results">
                    <div class="results-title">Results: ${choice.label}</div>
                    <div style="margin-bottom: 15px; font-style: italic;">"${choice.description}"</div>
            `;
            
            // Show metric changes
            Object.keys(choice.effects).forEach(metric => {
                const change = choice.effects[metric];
                const oldValue = oldMetrics[metric];
                const newValue = gameState.metrics[metric];
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const changeStr = change > 0 ? `+${change}` : `${change}`;
                
                resultsHTML += `
                    <div class="metric-change">
                        ${metric.charAt(0).toUpperCase() + metric.slice(1)}: ${oldValue} ‚Üí ${newValue} <span class="${changeClass}">(${changeStr})</span>
                    </div>
                `;
            });
            
            if (cascadeMessage) {
                resultsHTML += `<div style="margin-top: 15px; color: #ffff00;">${cascadeMessage}</div>`;
            }
            
            if (triggers.length > 0) {
                resultsHTML += `
                    <div class="triggers">
                        <div class="triggers-title">‚ö†Ô∏è TRIGGERED EVENTS:</div>
                        ${triggers.map(trigger => `<div>‚Ä¢ ${trigger}</div>`).join('')}
                    </div>
                `;
            }
            
            resultsHTML += `
                    <button class="continue-button" onclick="nextScenario()">Continue to Next Month</button>
                </div>
            `;
            
            document.getElementById('results-container').innerHTML = resultsHTML;
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('scenario-container').style.display = 'none';
        }

        // Track which crises are active and their previous values
        let activeCrisis = null;
        let crisisHistory = {};

        function nextScenario() {
            console.log("=== NEXT SCENARIO DEBUG ===");
            console.log("Current scenario:", gameState.currentScenario);
            console.log("Current metrics:", gameState.metrics);
            console.log("Crisis history:", crisisHistory);
            
            // Check for game over conditions first
            const gameOverInfo = checkForGameOver();
            if (gameOverInfo) {
                console.log("GAME OVER:", gameOverInfo);
                showGameOver(gameOverInfo);
                return;
            }
            
            // First, check if we need to handle a crisis
            const crisisType = findActiveCrisis();
            console.log("Crisis check result:", crisisType);
            
            if (crisisType) {
                // Check if this is a new crisis or if we need to repeat due to lack of improvement
                const shouldShowCrisis = shouldRepeatCrisis(crisisType);
                console.log("Should show crisis for", crisisType, "?", shouldShowCrisis);
                
                if (shouldShowCrisis) {
                    console.log("SHOWING CRISIS:", crisisType);
                    activeCrisis = crisisType;
                    showCrisisScenario(crisisType);
                    return; // Stop here, don't advance to next scenario
                } else {
                    console.log("Crisis improving, not showing repeat crisis scenario");
                    // Crisis is improving, clear it and continue
                    activeCrisis = null;
                    delete crisisHistory[crisisType];
                    // Clear sustained crisis counter
                    if (gameState.sustainedCrisisMonths) {
                        delete gameState.sustainedCrisisMonths[crisisType];
                    }
                }
            }
            
            // No crisis or crisis resolved, proceed to next regular scenario
            console.log("Proceeding to next regular scenario");
            advanceToNextScenario();
        }

        function findActiveCrisis() {
            // Check each metric for red zone crisis
            const metrics = ['financial', 'staff', 'student', 'reputation', 'research', 'local'];
            
            for (let metric of metrics) {
                if (gameState.metrics[metric] < 40) {
                    console.log(`CRISIS FOUND: ${metric} = ${gameState.metrics[metric]}`);
                    return metric;
                }
            }
            
            return null;
        }

        function shouldRepeatCrisis(crisisType) {
            const currentValue = gameState.metrics[crisisType];
            const previousValue = crisisHistory[crisisType];
            
            console.log(`Crisis ${crisisType}: previous=${previousValue}, current=${currentValue}`);
            
            // If no previous record, this is a new crisis
            if (previousValue === undefined) {
                console.log("New crisis - showing scenario");
                return true;
            }
            
            // If metric got worse or stayed the same, repeat crisis
            if (currentValue <= previousValue) {
                console.log("Crisis worsened or unchanged - showing scenario");
                return true;
            }
            
            // If metric improved, don't repeat crisis
            console.log("Crisis improved - not showing scenario");
            return false;
        }

        function showCrisisScenario(crisisType) {
            console.log("SHOWING CRISIS SCENARIO FOR:", crisisType);
            
            const crisis = crisisScenarios[crisisType];
            if (!crisis) {
                console.error("No crisis scenario defined for:", crisisType);
                activeCrisis = null; // Reset crisis state
                advanceToNextScenario(); // Continue with regular flow
                return;
            }
            
            // Force hide results container and show scenario container
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('scenario-container').style.display = 'block';
            
            const scenarioHTML = `
                <div class="scenario-title" style="color: #ff6666; background-color: #330000; padding: 10px; border-radius: 5px;">
                    üö® CRISIS: ${crisis.title} üö®
                </div>
                <div class="scenario-description" style="border: 3px solid #ff6666; padding: 20px; background-color: #1a0000; margin: 15px 0; border-radius: 5px;">
                    <strong style="color: #ff9999;">EMERGENCY SITUATION:</strong><br><br>
                    ${crisis.description}
                    <br><br>
                    <em style="color: #ffcccc;">You must resolve this crisis before continuing normal operations.</em>
                </div>
                <div class="choices">
                    ${crisis.choices.map((choice, index) => `
                        <button class="choice-button" onclick="handleCrisisChoice('${crisisType}', ${index})" 
                                style="border: 2px solid #ff6666; background-color: #330000;">
                            <div class="choice-label" style="color: #ff9999;">${choice.label}</div>
                            <div style="color: #ffcccc;">${choice.description}</div>
                        </button>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('scenario-container').innerHTML = scenarioHTML;
            console.log("Crisis scenario HTML set");
        }

        function handleCrisisChoice(crisisType, choiceIndex) {
            console.log("HANDLING CRISIS CHOICE:", crisisType, choiceIndex);
            
            // Record the current value before applying effects
            const valueBeforeChoice = gameState.metrics[crisisType];
            console.log(`Recording ${crisisType} value before choice:`, valueBeforeChoice);
            
            const crisis = crisisScenarios[crisisType];
            const choice = crisis.choices[choiceIndex];
            
            // Track cultural choice
            gameState.culturalChoices[choice.culture]++;
            
            // Apply effects
            const oldMetrics = {...gameState.metrics};
            Object.keys(choice.effects).forEach(metric => {
                gameState.metrics[metric] = Math.max(0, Math.min(100, gameState.metrics[metric] + choice.effects[metric]));
            });
            
            // Apply cascade effects
            const cascadeMessage = applyCascadeEffects();
            const positiveMessage = applyPositiveCascades();
            
            // Update display and record in history
            updateAllMetrics();
            recordMetricsInHistory();
            
            // Record the crisis value for comparison next time
            crisisHistory[crisisType] = gameState.metrics[crisisType];
            console.log(`Updated crisis history for ${crisisType}:`, crisisHistory[crisisType]);
            
            // Check if crisis is resolved (above 40) or improved
            const crisisResolved = gameState.metrics[crisisType] >= 40;
            const crisisImproved = gameState.metrics[crisisType] > valueBeforeChoice;
            
            console.log("Crisis resolved?", crisisResolved, `(${crisisType} = ${gameState.metrics[crisisType]})`);
            console.log("Crisis improved?", crisisImproved, `(${valueBeforeChoice} ‚Üí ${gameState.metrics[crisisType]})`);
            
            if (crisisResolved) {
                activeCrisis = null; // Clear active crisis
                delete crisisHistory[crisisType]; // Clear history
                console.log("Crisis fully resolved - clearing history");
            }
            
            // Show crisis results
            showCrisisResults(choice, oldMetrics, cascadeMessage + positiveMessage, crisisType, crisisResolved, crisisImproved);
        }

        function showCrisisResults(choice, oldMetrics, cascadeMessage, crisisType, crisisResolved, crisisImproved) {
            const triggers = checkTriggers(oldMetrics);
            
            let resultsHTML = `
                <div class="results" style="border: 3px solid #ff6666; background-color: #1a0000;">
                    <div class="results-title" style="color: #ff6666;">üö® CRISIS RESPONSE: ${choice.label}</div>
                    <div style="margin-bottom: 15px; font-style: italic; color: #ffcccc;">"${choice.description}"</div>
            `;
            
            // Show metric changes
            Object.keys(choice.effects).forEach(metric => {
                const change = choice.effects[metric];
                const oldValue = oldMetrics[metric];
                const newValue = gameState.metrics[metric];
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const changeStr = change > 0 ? `+${change}` : `${change}`;
                
                resultsHTML += `
                    <div class="metric-change">
                        ${metric.charAt(0).toUpperCase() + metric.slice(1)}: ${oldValue} ‚Üí ${newValue} <span class="${changeClass}">(${changeStr})</span>
                    </div>
                `;
            });
            
            if (cascadeMessage) {
                resultsHTML += `<div style="margin-top: 15px; color: #ffff00;">${cascadeMessage}</div>`;
            }
            
            if (triggers.length > 0) {
                resultsHTML += `
                    <div class="triggers">
                        <div class="triggers-title">‚ö†Ô∏è ONGOING ALERTS:</div>
                        ${triggers.map(trigger => `<div>‚Ä¢ ${trigger}</div>`).join('')}
                    </div>
                `;
            }
            
            // Crisis status display with improvement logic
            let statusColor, statusIcon, statusMessage;
            
            if (crisisResolved) {
                statusColor = '#00ff00';
                statusIcon = '‚úÖ';
                statusMessage = `Crisis fully resolved! ${crisisType.charAt(0).toUpperCase() + crisisType.slice(1)} is back in safe zone (${gameState.metrics[crisisType]}). Returning to normal operations.`;
            } else if (crisisImproved) {
                statusColor = '#ffff00';
                statusIcon = 'üìà';
                statusMessage = `Crisis improving! ${crisisType.charAt(0).toUpperCase() + crisisType.slice(1)} is still critical (${gameState.metrics[crisisType]}) but getting better. Continue normal operations.`;
            } else {
                statusColor = '#ff6666';
                statusIcon = '‚ö†Ô∏è';
                statusMessage = `Crisis persists! ${crisisType.charAt(0).toUpperCase() + crisisType.slice(1)} remains critical (${gameState.metrics[crisisType]}) with no improvement. Crisis will continue next month.`;
            }
            
            resultsHTML += `
                <div style="margin: 20px 0; padding: 15px; border-radius: 5px; background-color: ${crisisResolved ? '#001a00' : crisisImproved ? '#1a1a00' : '#1a0000'}; border: 2px solid ${statusColor};">
                    <strong style="color: ${statusColor};">CRISIS STATUS:</strong><br>
                    <span style="color: ${statusColor};">${statusIcon} ${statusMessage}</span>
                </div>
                <button class="continue-button" onclick="nextScenario()" style="background-color: ${crisisResolved ? '#003300' : crisisImproved ? '#333300' : '#330000'}; border-color: ${statusColor};">
                    Continue Management
                </button>
            `;
            
            document.getElementById('results-container').innerHTML = resultsHTML;
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('scenario-container').style.display = 'none';
        }

        function advanceToNextScenario() {
            console.log("ADVANCING TO NEXT SCENARIO");
            
            gameState.currentScenario++;
            gameState.currentMonth++;
            
            if (gameState.currentMonth >= 12) {
                gameState.currentMonth = 0;
                gameState.currentYear++;
            }
            
            console.log("New scenario:", gameState.currentScenario, "Month:", months[gameState.currentMonth]);
            
            // Update display counters
            const monthElement = document.getElementById('current-month');
            const yearElement = document.getElementById('current-year');
            const countElement = document.getElementById('scenario-count');
            
            if (monthElement) monthElement.textContent = months[gameState.currentMonth];
            if (yearElement) yearElement.textContent = gameState.currentYear;
            if (countElement) countElement.textContent = gameState.currentScenario + 1;
            
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('scenario-container').style.display = 'block';
            
            displayScenario();
        }

        // Check if running as installed PWA
        function isRunningStandalone() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'campus-simulator-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Initialize intro screen on load - game will start when player clicks the button
        window.addEventListener('load', () => {
            // Check if app is installed
            if (isRunningStandalone()) {
                isAppInstalled = true;
                console.log('Running as installed PWA');
            }
            
            // Try to load saved game
            const hasLoadedGame = loadGame();
            
            if (hasLoadedGame && gameState.currentScenario > 0) {
                // Game in progress - ask if they want to continue
                showContinuePrompt();
            } else {
                // New game - show intro
                showIntroScreen();
            }
        });
    </script>
</body>
</html>